<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/integration"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:s3="http://www.opencredo.com/schema/integration/s3"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
 	        http://www.springframework.org/schema/integration
			http://www.springframework.org/schema/integration/spring-integration-1.0.xsd
	        http://www.opencredo.com/schema/integration/s3
			http://www.opencredo.com/schema/integration/s3/spring-integration-s3-1.0.xsd">
	
	<beans:bean id="awsCredentials" class="org.opencredo.aws.s3.AWSCredentials">
        <beans:constructor-arg index="0" value="${settings.key}"/>
        <beans:constructor-arg index="1" value="${settings.secretkey}"/>
    </beans:bean>

	<channel id="inputS3Poller" />
	<s3:inbound-channel-adapter credentials="awsCredentials" bucket="sibucket" channel="inputS3Poller" filter="acceptOnceS3ObjectListFilter" comparator="testComparator" delete-when-received="true">
		<poller>
			<interval-trigger interval="5000"/>
		</poller>		
	</s3:inbound-channel-adapter>
	
	<channel id="transformedStringMessages" />
	<service-activator input-channel="inputS3Poller" 
 	   	   ref="s3ToStringTransformer" 
 	   	   method="transform" 
 	   	   output-channel="transformedStringMessages"/>   	   
 	<beans:bean id="s3ToStringTransformer" class="org.opencredo.aws.s3.transformer.S3ToStringTransformer"/>
	
	<beans:bean id="acceptOnceS3ObjectListFilter" class="org.opencredo.aws.s3.AcceptOnceS3ObjectListFilter"/>		

	<beans:bean id="testComparator"
		class="org.opencredo.aws.s3.config.S3InboundChannelAdapterParserTest$TestComparator" />
 	
</beans:beans>